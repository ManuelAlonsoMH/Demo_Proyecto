
create database  if not exists FARMACIAPASTILLEROC;

USE FARMACIAPASTILLEROC;


CREATE TABLE  if not exists MEDICAMENTO(
ID_MED CHAR(8) PRIMARY KEY,
NOMBRE VARCHAR(20) NOT NULL,
PRECIOVENTA INT(4) NOT NULL,
PRECIOCOSTO INT(4) NOT NULL);


 CREATE TABLE   if not exists CLIENTE(
 CLIENTEID CHAR(8) PRIMARY KEY,
 NOMBRE VARCHAR(20) NOT NULL,
 APELLIDOPATERNO VARCHAR(15) NOT NULL,
 APELLIDOMATERNO VARCHAR(15) NOT NULL,
 CALLE VARCHAR(15) NOT NULL,
 NUMERO INT(5) NOT NULL,
 COLONIA VARCHAR(30) NOT NULL,
 CP INT(5) NOT NULL);
 

 CREATE TABLE  if not exists DISTRIBUIDOR(
 DISTRIBUIDORID CHAR(8) PRIMARY KEY,
 NOMBRE VARCHAR(20) NOT NULL,
 NoTELEFONO CHAR(15) NOT NULL,
 DIRECCION VARCHAR(50) NOT NULL,
 ESTADO VARCHAR(20) NOT NULL,
 CIUDAD VARCHAR(20) NOT NULL);
 

 CREATE TABLE  if not exists VENTA(
 VENTAID CHAR(8) PRIMARY KEY,
 FECHA DATE NOT NULL,
 MONTOFINAL INT(8) NOT NULL,
 CLIENTEID CHAR(8) NOT NULL,
 FOREIGN KEY (CLIENTEID) REFERENCES CLIENTE(CLIENTEID));
 

CREATE TABLE  if not exists MEDICAMENTOVENTA(
ID_MED CHAR(8) NOT NULL,
VENTAID CHAR(8) NOT NULL,
CANTIDAD INT(4) NOT NULL,
FOREIGN KEY (ID_MED) REFERENCES MEDICAMENTO(ID_MED),
FOREIGN KEY (VENTAID) REFERENCES VENTA(VENTAID),
PRIMARY KEY (ID_MED, VENTAID));
  

 CREATE TABLE  if not exists COMPRA(
 COMPRAID CHAR(8) PRIMARY KEY,
 FECHA DATE NOT NULL,
 ID_MED CHAR(8) NOT NULL,
 DISTRIBUIDORID CHAR(8) NOT NULL,
 FOREIGN KEY (ID_MED) REFERENCES MEDICAMENTO(ID_MED),
 FOREIGN KEY (DISTRIBUIDORID) REFERENCES DISTRIBUIDOR(DISTRIBUIDORID));
 
 

INSERT INTO CLIENTE(CLIENTEID, NOMBRE, APELLIDOPATERNO, APELLIDOMATERNO, CALLE, NUMERO, COLONIA, CP) VALUES
('CLIE0001','Manuel','Morales','Hurtado','Santiago',218,'Tulantepec',43760),
('CLIE0002','GERMAN','GOMEZ','CRUZ','Habitacional',218,'JARDINES DEL SUR',43760),
('CLIE0003','GRESSIA GERMAN','juares','AVILES','2 DE AGOSTO',218,'EL PARAISO',43630),
('CLIE0004','Hilda','Hernandez','Guerrero','paraio',218,'NAYARIT',43640),
('CLIE0005','Oscar','Sanchez','Romo','PAVON',218,'MORELOS',43650);

INSERT INTO DISTRIBUIDOR(DISTRIBUIDORID, NOMBRE, NoTELEFONO, DIRECCION, ESTADO, CIUDAD) VALUES
('DISTR001','FARMACOS NACIONALES',017725824926,'AQUILES SERDAN 1514 CAMINO INTERPARCELARIA','AGUASCALIENTES','AGUASCALIENTES'),
('DISTR002','FARMACOS PASTILLERO',017757530826,'MIGUEL HIDALGO 315, JAVIER ROJO GÃ“MEZ','HIDALGO','TULANCINGO'),
('DISTR003','NADRO',0447735121823,'AV SAN PABLO XALPA 2, SANTA BARBARA','CIUDAD DE MEXICO','CDMX'),
('DISTR004','FARMACO GI',017797969220,'CALLE 4 SUR No.123, Cd. INDUSTRIAL TIZAYUCA, 43800','HIDALGO','TIZAYUCA');


INSERT INTO MEDICAMENTO(ID_MED, NOMBRE, PRECIOVENTA, PRECIOCOSTO) VALUES
('PRODU001','ASPIRINA',55,30),
('PRODU002','PARACETAMOL',35,20),
('PRODU003','NEXT',50,25),
('PRODU004','BRONCOLIN',70,45),
('PRODU005','DICLOFENACO',30,15);


INSERT INTO COMPRA(COMPRAID, FECHA, ID_MED, DISTRIBUIDORID) VALUES
('COMPRA01','2018-05-15','PRODU001','DISTR001'),
('COMPRA02','2018-05-15','PRODU002','DISTR004'),
('COMPRA03','2018-05-20','PRODU001','DISTR001'),
('COMPRA04','2018-05-22','PRODU001','DISTR001');


INSERT INTO VENTA(VENTAID, FECHA, MONTOFINAL, CLIENTEID) VALUES
('VENTA001','2018-06-25',200,'CLIE0001'),
('VENTA002','2018-06-04',100,'CLIE0002'),
('VENTA003','2018-06-10',400,'CLIE0003'),
('VENTA004','2018-06-11',150,'CLIE0004'),
('VENTA005','2018-01-12',30,'CLIE0005');


INSERT INTO MEDICAMENTOVENTA(ID_MED, VENTAID, CANTIDAD) VALUES
('PRODU001','VENTA001',5),
('PRODU002','VENTA002',7),
('PRODU003','VENTA003',30),
('PRODU004','VENTA004',8),
('PRODU005','VENTA005',5);

 
create view vista1
as select * from MEDICAMENTO;

describe vista1;

create view vista2
as select*from cliente;

describe vista2;

CREATE PROCEDURE seleccion()
SELECT *FROM MEDICAMENTO;

call seleccion;



create procedure introducir()
insert into cliente (CLIENTEID, NOMBRE, APELLIDOPATERNO, APELLIDOMATERNO, CALLE, NUMERO, COLONIA, CP) values ('CLIE0006','Manuel Alonso','Morales','Hurtado','Pemex',219,'Santiago',43760);

 create table ventas3(
     folio          varchar(7) primary key,
     cantidad       int        not null,
     vendido        int        not null,
    ID_MED CHAR(8)       not null);


 alter table ventas3
 add foreign key(  ID_MED) references MEDICAMENTO (  ID_MED);

 describe ventas3 ;

 create trigger ventas3
     after insert on ventas
     for each row update CLIENTE
     set  cantidad=cantidad-new.cantidad
     where  ID_MED =new. ID_MED ;


 insert into ventas3 (folio , cantidad , ID_MED)values
    ("A0001",20,201),
    ("A0002",25,102),
     ("A0003",27,305);



 create table compras(
     folio       varchar(7)   primary key,
     cantidad    int          not null,
     comprado    int          not null,
     ID_MED CHAR(8)         not null);

alter table compras
add foreign key(  ID_MED) references MEDICAMENTO (  ID_MED);
Query OK, 0 rows affected (1.12 sec)
Records: 0  Duplicates: 0  Warnings: 0

create trigger compras
     after insert on compras
     for each row update DISTRIBUIDOR
     set cantidad=cantidad+new.cantidad
     where  ID_MED =new. ID_MED ;